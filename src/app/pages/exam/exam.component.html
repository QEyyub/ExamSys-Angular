<div class="exam-container">

  <h2>İmtahanların Siyahısı</h2>

  <button mat-raised-button color="primary" (click)="openCreateModal()">Yeni İmtahan Əlavə Et</button>

  <mat-form-field appearance="outline" style="margin-left: 16px; width: 300px;">
    <mat-label>Axtarış</mat-label>
    <input matInput (keyup)="applyFilter($event)" placeholder="Axtarış...">
  </mat-form-field>

  <div *ngIf="loading" style="margin-top: 20px;">Yüklənir...</div>
  <div *ngIf="error" class="error" style="color:red; margin-top: 20px;">{{ error }}</div>

  <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8" *ngIf="!loading && !error">

    <ng-container matColumnDef="lessonCode">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Dərs Kodu</th>
      <td mat-cell *matCellDef="let element">{{ element.lessonCode }}</td>
    </ng-container>

    <ng-container matColumnDef="studentNumber">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Şagird No</th>
      <td mat-cell *matCellDef="let element">{{ element.studentNumber }}</td>
    </ng-container>

    <ng-container matColumnDef="examDate">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>İmtahan Tarixi</th>
      <td mat-cell *matCellDef="let element">{{ element.examDate | date }}</td>
    </ng-container>

    <ng-container matColumnDef="grade">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Qiymət</th>
      <td mat-cell *matCellDef="let element">{{ element.grade }}</td>
    </ng-container>

    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Əməliyyatlar</th>
      <td mat-cell *matCellDef="let element">
        <button mat-icon-button color="primary" (click)="openEditModal(element)">
          <mat-icon>edit</mat-icon>
        </button>
<button mat-icon-button color="warn" (click)="deleteExam(element.lessonCode, element.studentNumber)">
  <mat-icon>delete</mat-icon>
</button>

      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>

  <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>

<div class="modal" *ngIf="isModalOpen">
  <div class="modal-content">
    <h3>{{ isEditMode ? 'İmtahanı Yenilə' : 'Yeni İmtahan Əlavə Et' }}</h3>

    <div *ngIf="error" style="color: red; margin-bottom: 10px;">
      {{ error }}
    </div>

    <form (ngSubmit)="onSubmit()">

      <mat-form-field appearance="fill" style="width: 100%;">
        <mat-label>Dərs Kodu</mat-label>
        <mat-select [(ngModel)]="selectedExam.lessonCode" name="lessonCode" required>
          <mat-option *ngFor="let code of validLessonCodes" [value]="code">
            {{ code }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="fill" style="width: 100%;">
        <mat-label>Şagird Nömrəsi</mat-label>
        <mat-select [(ngModel)]="selectedExam.studentNumber" name="studentNumber" required>
          <mat-option *ngFor="let num of validStudentNumbers" [value]="num">
            {{ num }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="fill" style="width: 100%;">
        <mat-label>İmtahan Tarixi</mat-label>
        <input matInput type="date" [(ngModel)]="selectedExam.examDate" name="examDate" required>
      </mat-form-field>

      <mat-form-field appearance="fill" style="width: 100%;">
        <mat-label>Qiymət</mat-label>
        <input matInput type="number" [(ngModel)]="selectedExam.grade" name="grade" required min="0" max="100">
      </mat-form-field>

      <div style="margin-top: 16px; text-align: right;">
        <button mat-stroked-button color="primary" type="submit">{{ isEditMode ? 'Yenilə' : 'Əlavə Et' }}</button>
        <button mat-button type="button" (click)="closeModal()">Ləğv et</button>
      </div>
    </form>
  </div>
</div>
</div>
